function [bestacc,bestc,bestg,bestr] = SVMcgForClass(train_label,train,cmin,cmax,gmin,gmax,v,cstep,gstep,accstep)
%last modified 2009.8.23
% 
% train_label:训练集标签.要求与libsvm工具箱中要求一致.
% train:训练集.要求与libsvm工具箱中要求一致.
% cmin:惩罚参数c的变化范围的最小值(取以2为底的对数后),即 c_min = 2^(cmin).默认为 -5
% cmax:惩罚参数c的变化范围的最大值(取以2为底的对数后),即 c_max = 2^(cmax).默认为 5
% gmin:参数g的变化范围的最小值(取以2为底的对数后),即 g_min = 2^(gmin).默认为 -5
% gmax:参数g的变化范围的最小值(取以2为底的对数后),即 g_min = 2^(gmax).默认为 5
% 
% v:cross validation的参数,即给测试集分为几部分进行cross validation.默认为 3
% cstep:参数c步进的大小.默认为 1
% gstep:参数g步进的大小.默认为 1
% accstep:最后显示准确率图时的步进大小. 默认为 1.5
%[上面这些参数大家可以更改以期达到最佳效果,也可不改用默认值]
%% about the ption [bestacc,bestc,bestg] = SVMcgForClass(train_label,train,cmin,cmax,gmin,gmax,v,cstep,gstep,accstep)
%arameters of SVMcg 
if nargin < 10
    accstep = 1.5;
end
if nargin < 9
    cstep = 1;
    gstep = 1;
end
if nargin < 8
    v = 3;
    cstep = 1;
    gstep = 1;
end
if nargin <7
    v = 3;
    cstep = 1;
    gstep = 1;
    rstep = 5;
end
if nargin < 6
    v = 3;
    cstep = 1;
    gstep = 1;
    gmax = 5;
    gmin = -5;
end
if nargin < 5
    v = 3;
    cstep = 1;
    gstep = 1;
    gmax = 5;
    gmin = -5;
    cmax = 5;
end
if nargin < 4
    v = 3;
    cstep = 1;
    gstep = 1;
    rstep = 1;
    gmax = 5;
    gmin = -5;
    cmax = 5;
    cmin = -5;
end
%% X:c Y:g cg:acc
[X,Y,] = meshgrid(cmin:cstep:cmax,gmin:gstep:gmax);
[m,n] = size(X);
cg = zeros(m,n);
%% record acc with different c & g,and find the bestacc with the smallest c
bestc = 0;
bestg = 0;
bestacc = 0;
basenum = 2;
for i = 1:m
    for j = 1:n
        cmd = ['-v ',num2str(v),' -c ',num2str( basenum^X(i,j) ),' -g ',num2str( basenum^Y(i,j) )];
        cg(i,j) = svmtrain(train_label, train, cmd);
        
        if cg(i,j) > bestacc
            bestacc = cg(i,j);
            bestc = basenum^X(i,j);
            bestg = basenum^Y(i,j);
        end
        if ( cg(i,j) == bestacc && bestc > basenum^X(i,j) )
            bestacc = cg(i,j);
            bestc = basenum^X(i,j);
            bestg = basenum^Y(i,j);
        end
        
    end
end
%% to draw the acc with different c & g
 figure;
 [C,h] = contour(X,Y,cg,80:accstep:100);
 clabel(C,h,'Color','r');
 xlabel('log2c','FontSize',12);
 ylabel('log2g','FontSize',12);
 title('参数选择结果图(等高线图)','FontSize',12);
 grid on;
 
 figure;
  meshc(X,Y,cg);
  mesh(X,Y,cg);
  surf(X,Y,cg);
 axis([cmin,cmax,gmin,gmax,30,100]);
 xlabel('log2c','FontSize',12);
 ylabel('log2g','FontSize',12);
 zlabel('Accuracy(%)','FontSize',12);
 title('参数选择结果图(3D视图)','FontSize',12);

